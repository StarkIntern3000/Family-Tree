
import java.util.*;

public class MainFile {
    public static void main(String args[]){
        Person[] mainTree = null;
        TreeReader tReader = new TreeReader();
        
        String type;
        String name;
        boolean state;
        //TreeReader tReader = new TreeReader();
        RelationReader relationReader = null;
        state = true;
        while(state){
            boolean checker = false;
            Scanner scanner = new Scanner(System. in); 
            String input = scanner. nextLine();
            String[] inputArray = input.split(" ");
            
            try{
                type = inputArray[0];
            }catch(Exception e){
                continue;
            }
            
            if(mainTree == null){
                switch(type){
                    case "bye":
                        state = false;
                        System.out.println("Goodbye!");
                        break;
                    case "load":
                        name = inputArray[1];
                        mainTree = tReader.loadTree(name);
                        relationReader = new RelationReader(mainTree);
                        break;
                    default: 
                        System.out.println("unrecognized keyword " + type);
                }
            }else{
                if(inputArray.length == 1){
                    switch(type){
                        case "bye":
                            state = false;
                            System.out.println("Goodbye.");
                            break;
                        case "count":
                            System.out.println(mainTree.length);
                            break;
                        default: 
                            System.out.println("unrecognized keyword " + type);
                    }
                }else if(inputArray.length == 2){
                    switch(type){
                        case "age":
                            name = inputArray[1];
                            
                            
                            if(tReader.personSearch(mainTree, name) != null){
                                System.out.println(tReader.personSearch(mainTree, name).returnAge());
                                checker = true;
                            }
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                            
                        case "sex":
                            name = inputArray[1];
                            if(tReader.personSearch(mainTree, name) != null){
                                System.out.println(tReader.personSearch(mainTree, name).returnSex());
                                checker = true;
                            }
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                        case "gender":
                            name = inputArray[1];
                            if(tReader.personSearch(mainTree, name) != null){
                                System.out.println(tReader.personSearch(mainTree, name).returnGender());
                                checker = true;
                            }
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                        case "ancestors":
                            name = inputArray[1];
                            break;
                        case "descendants":
                            name = inputArray[1];
                            break;
                        case "load":
                            name = inputArray[1];
                            mainTree = tReader.loadTree(name);
                            break;
                        case "save":
                            name = inputArray[1];
                            tReader.writeTree(name);
                            break;
                        default: 
                            System.out.println("unrecognized keyword " + type);
                    }
                }else if(inputArray.length == 3){
                    switch(type){
                        case "edit-name":
                            name = inputArray[1];
                            String newName = inputArray[2];
                            
                            boolean unique = tReader.nameChecker(newName);
                            if(tReader.personSearch(mainTree, name) != null && unique){
                                checker = true;
                                tReader.personSearch(mainTree, name).AttriEditor("name",newName);
                                    break;
                            }
                            
                            if(!(tReader.personSearch(mainTree, name) != null)&&unique){
                                System.out.println("no such person " + name);
                                break;
                            }else if(!(tReader.personSearch(mainTree, name) != null)&&!unique){
                                System.out.println("no such person " + name);
                                System.out.println("Person " + newName + " already exists.");
                                break;
                            }else if(tReader.personSearch(mainTree, name) != null && !(unique)){
                                System.out.println("Person " + newName + " already exists.");
                                break;
                            }
                            
                            break;
                        case "edit-age":
                            name = inputArray[1];
                            String newAge = inputArray[2];
                            
                            if(tReader.personSearch(mainTree, name) != null){
                                checker = true;
                                tReader.personSearch(mainTree, name).AttriEditor("age",newAge);
                                    break;
                            }
                            
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                        case "edit-sex":
                            name = inputArray[1];
                            String newSex = inputArray[2];
                            
                            if(tReader.personSearch(mainTree, name) != null){
                                checker = true;
                                tReader.personSearch(mainTree, name).AttriEditor("name",newSex);
                                    break;
                            }
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                        case "edit-gender":
                            name = inputArray[1];
                            String newGender = inputArray[2];
                            
                            if(tReader.personSearch(mainTree, name) != null){
                                checker = true;
                                tReader.personSearch(mainTree, name).AttriEditor("name",newGender);
                                    break;
                            }
                            if(!checker){
                                System.out.println("no such person " + name);
                            }
                            break;
                        case "relationship":
                            name = inputArray[1];
                            String nameCompared = inputArray[2];
                            boolean nameAExist = false;
                            boolean nameBExist = false;
                            if(tReader.personSearch(mainTree, name)!=null){
                                nameAExist = true;
                            }
                            if(tReader.personSearch(mainTree, nameCompared) != null){
                                nameBExist = true;
                            }
                                
                            if(nameAExist && nameBExist){
                                relationReader.Relationship(tReader.personSearch(mainTree, name),tReader.personSearch(mainTree, nameCompared));
                            }else if(!nameAExist && nameBExist){
                                System.out.println("no such person " + name);
                            }else if(nameAExist && !nameBExist){
                                System.out.println("no such person " + nameCompared);
                            }else if(!nameAExist && !nameBExist){
                                System.out.println("no such person " + name);
                                System.out.println("no such person " + nameCompared);
                            }
                            
                            break;
                        default: 
                            System.out.println("unrecognized keyword " + type);
                    }
                }
            }      
        }
    }
}
